<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('csvFileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                Papa.parse(file, {
                    header: true,
                    dynamicTyping: true,
                    complete: function(results) {
                        const data = results.data.filter(row => Object.values(row).some(value => value !== null && value !== ""));
                        const tableContainer = document.getElementById('tableContainer');
                        tableContainer.innerHTML = ''; // Clear previous table
                        const table = document.createElement('div');
                        table.id = 'dataTable';
                        tableContainer.appendChild(table);
                        new Tabulator("#dataTable", {
                            data: data,
                            autoColumns: true,
                            layout: "fitData",
                            resizableColumns: true,
                            columns: Object.keys(data[0]).map(key => ({ title: key, field: key, headerWordWrap: true, formatter: "textarea" }))
                        });

                        const labels = data.map(row => row[Object.keys(row)[0]]);
                        const chartData = {
                            labels: labels,
                            datasets: [{
                                label: 'Dataset',
                                data: data.map(row => row[Object.keys(row)[1]]),
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1
                            }]
                        };
                        const ctx = document.getElementById('myChart').getContext('2d');
                        new Chart(ctx, {
                            type: 'bar',
                            data: chartData,
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                });
            }
        });
    });
</script>